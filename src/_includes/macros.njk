{# Treat this as an iterative program, not a template. #}
{% macro render_word(word, dict) %}
<div class="word">
  {% for het in word[dict].heteronyms %}
    </ol>
    <h1>{{word.title}}</h1>
    {% set pronunciation = false %}
    {% if dict == "kisaragi_dict" %}
      {% set pronunciation = het.pronunciation %}
    {% elif dict == "moedict_zh" %}
      {% set pronunciation = het.bopomofo %}
    {% elif dict == "moedict_twblg" %}
      {% set pronunciation = het.trs %}
    {% endif %}
    {% if pronunciation %}
    <p>讀音：<span>{{ pronunciation | spc }}</span></p>
    {% endif %}
    {% set lasttype = "" %}
    {% set first = true %}
    {% for def in het.definitions %}
      {% if def.type %}
        {% if lasttype == def.type %}
        {% else %}
          {% if not first %}
          </ol>
          {% endif %}
          {% set first = false %}
          <p class="pos">{{ def.type }}</p>
          <ol>
        {% endif %}
        {% set lasttype = def.type %}
      {% else %}
        <ol>
      {% endif %}
      {% if dict == "kisaragi_dict" %}
        <li>
          <p class="def">
          {{ def.def | process_def_kisaragi | safe }}
          {{ def.example }}
          </p>
          <p>
          {{ def.etymology | process_def_kisaragi | safe }}
          </p>
          {% for quote in def.quote %}
          <p>{{ quote }}</p>
          {% endfor %}
        </li>
      {% elif dict == "moedict_zh" %}
        <li>
          <p class="def">
          <span>{{ def.def | process_def_moedict_zh | safe }}</span>
          {% for ex in def.example %}
          <span>{{ ex | process_def_moedict_zh | safe }}</span>
          {% endfor %}
          {% for quote in def.quote %}
          <span>{{ quote }}</span>
          {% endfor %}</p>
        </li>
      {% elif dict == "moedict_twblg" %}
        <li>
          <p class="def">{{ def.def }}</p>
          {{ def.example | interlinear_annotation_to_ruby | safe }}
          {{ def.quote | interlinear_annotation_to_ruby | safe }}
        </li>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>
{% endmacro %}
